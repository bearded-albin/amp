<script>
let pageReloads = 0;
const MAX_RELOADS = 1;

window.addEventListener('load', function() {{
    pageReloads++;
    console.log('Page loaded (reload count: ' + pageReloads + ')');
    if (pageReloads <= MAX_RELOADS) {{
        console.log('Reloading to initialize iframe...');
        setTimeout(function() {{
            location.reload();
        }}, 1500);
    }} else {{
        console.log('Starting address injection...');
        setTimeout(startAddressInjection, 1000);
    }}
}});

function startAddressInjection() {{
    const iframe = document.querySelector('iframe');
    if (!iframe) {{
        console.log('iframe not found');
        return;
    }}
    
    let attempts = 0;
    const maxAttempts = 20;
    
    const injectionInterval = setInterval(function() {{
        attempts++;
        try {{
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            if (!iframeDoc) {{
                if (attempts >= maxAttempts) {{
                    console.log('Cannot access iframe - likely cross-origin');
                    clearInterval(injectionInterval);
                }}
                return;
            }}
            
            // Try different selectors for search input
            let searchInput = iframeDoc.querySelector('input[placeholder*="SÃ¶k"]');
            if (!searchInput) searchInput = iframeDoc.querySelector('input[type="text"]');
            if (!searchInput) searchInput = iframeDoc.querySelector('input[placeholder*="Search"]');
            
            if (searchInput) {{
                console.log('Found search input, injecting address...');
                
                // Get address from the page context
                const addressText = document.querySelector('.header .address').textContent;
                const cleanAddress = addressText.trim();
                
                // Inject the address
                searchInput.value = cleanAddress;
                searchInput.focus();
                searchInput.dispatchEvent(new Event('input', {{ bubbles: true }}));
                searchInput.dispatchEvent(new Event('change', {{ bubbles: true }}));
                
                // Simulate Enter key press
                const enterEvent = new KeyboardEvent('keydown', {{
                    key: 'Enter',
                    code: 'Enter',
                    keyCode: 13,
                    bubbles: true
                }});
                searchInput.dispatchEvent(enterEvent);
                
                console.log('Address injected: ' + cleanAddress);
                clearInterval(injectionInterval);
            }} else if (attempts >= maxAttempts) {{
                console.log('Search input not found after ' + maxAttempts + ' attempts');
                clearInterval(injectionInterval);
            }}
        }} catch (e) {{
            console.log('Injection error (attempt ' + attempts + '): ' + e.message);
            if (attempts >= maxAttempts) clearInterval(injectionInterval);
        }}
    }}, 400);
}}

function switchTab(tabNumber) {{
    // Hide all tabs
    const tabs = document.querySelectorAll('.tab-content');
    tabs.forEach(tab => tab.classList.remove('active'));
    
    // Remove active class from all buttons
    const btns = document.querySelectorAll('.tab-btn');
    btns.forEach(btn => btn.classList.remove('active'));
    
    // Show selected tab
    document.getElementById('tab' + tabNumber).classList.add('active');
    
    // Add active class to button
    event.target.classList.add('active');
}}
</script>